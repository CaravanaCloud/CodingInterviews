version: 0.2

phases:
  install:
    commands:
      - echo Entered the install phase as $USER
      - curl -s "https://get.sdkman.io" | bash
      - source "/root/.sdkman/bin/sdkman-init.sh" && sdk install java && sdk install maven
  build:
    commands:
      - echo Entered the build phase...
      - mkdir -p target/reports
# Java
      - mvn -Dmaven.test.failure.ignore=true --fail-at-end test
      - mvn surefire-report:report  -Daggregate=true
      - mvn site -DgenerateReports=false
      - mkdir reports/java/
      - mv target/site/* target/reports/java/
# Python
      - pushd rom-to-dec && pytest --html=../reports/python/rom-to-dec.html --self-contained-html
# Up reports
      - aws s3 sync reports/ s3://codinginterviews.caravana.cloud/ --delete
cache:
  paths:
    - '/root/.m2/**/*'
    - '/root/.sdkman/**/*'
